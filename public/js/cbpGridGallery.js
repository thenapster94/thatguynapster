/**
 * cbpGridGallery.js v1.0.0
 * http://www.codrops.com
 *
 * Licensed under the MIT license.
 * http://www.opensource.org/licenses/mit-license.php
 * 
 * Copyright 2014, Codrops
 * http://www.codrops.com
 */
!function(e){"use strict";var t=e.document.documentElement,s={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"}[Modernizr.prefixed("transition")],i=Modernizr.csstransitions,r=Modernizr.csstransforms3d;function n(e,t){e.style.WebkitTransform=t,e.style.msTransform=t,e.style.transform=t}function o(){var s=t.clientWidth,i=e.innerWidth;return s<i?i:s}function a(e,t){for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);return e}function l(e,t){this.el=e,this.options=a({},this.options),a(this.options,t),this._init()}l.prototype.options={},l.prototype._init=function(){this.grid=this.el.querySelector("section.grid-wrap > ul.grid"),this.gridItems=[].slice.call(this.grid.querySelectorAll("li:not(.grid-sizer)")),this.itemsCount=this.gridItems.length,this.slideshow=this.el.querySelector("section.slideshow > ul"),this.slideshowItems=[].slice.call(this.slideshow.children),this.current=-1,this.ctrlPrev=this.el.querySelector("section.slideshow > nav > span.nav-prev"),this.ctrlNext=this.el.querySelector("section.slideshow > nav > span.nav-next"),this.ctrlClose=this.el.querySelector("section.slideshow > nav > span.nav-close"),this._initMasonry(),this._initEvents()},l.prototype._initMasonry=function(){var e=this.grid;imagesLoaded(e,function(){new Masonry(e,{itemSelector:"li",columnWidth:e.querySelector(".grid-sizer")})})},l.prototype._initEvents=function(){var s=this;this.gridItems.forEach(function(e,t){e.addEventListener("click",function(){s._openSlideshow(t)})}),this.ctrlPrev.addEventListener("click",function(){s._navigate("prev")}),this.ctrlNext.addEventListener("click",function(){s._navigate("next")}),this.ctrlClose.addEventListener("click",function(){s._closeSlideshow()}),e.addEventListener("resize",function(){s._resizeHandler()}),document.addEventListener("keydown",function(e){if(s.isSlideshowVisible)switch(e.keyCode||e.which){case 37:s._navigate("prev");break;case 39:s._navigate("next");break;case 27:s._closeSlideshow()}}),e.addEventListener("scroll",function(){s.isSlideshowVisible?e.scrollTo(s.scrollPosition?s.scrollPosition.x:0,s.scrollPosition?s.scrollPosition.y:0):s.scrollPosition={x:e.pageXOffset||t.scrollLeft,y:e.pageYOffset||t.scrollTop}})},l.prototype._openSlideshow=function(e){if(this.isSlideshowVisible=!0,this.current=e,classie.addClass(this.el,"slideshow-open"),this._setViewportItems(),classie.addClass(this.currentItem,"current"),classie.addClass(this.currentItem,"show"),this.prevItem){classie.addClass(this.prevItem,"show");var t=Number(-1*(o()/2+this.prevItem.offsetWidth/2));n(this.prevItem,r?"translate3d("+t+"px, 0, -150px)":"translate("+t+"px)")}if(this.nextItem){classie.addClass(this.nextItem,"show");t=Number(o()/2+this.nextItem.offsetWidth/2);n(this.nextItem,r?"translate3d("+t+"px, 0, -150px)":"translate("+t+"px)")}},l.prototype._navigate=function(e){if(!this.isAnimating)if("next"===e&&this.current===this.itemsCount-1||"prev"===e&&0===this.current)this._closeSlideshow();else{this.isAnimating=!0,this._setViewportItems();var t,a,l,h=this,c=this.currentItem.offsetWidth,m=r?"translate3d(-"+Number(o()/2+c/2)+"px, 0, -150px)":"translate(-"+Number(o()/2+c/2)+"px)",d=r?"translate3d("+Number(o()/2+c/2)+"px, 0, -150px)":"translate("+Number(o()/2+c/2)+"px)";"next"===e?(t=r?"translate3d( -"+Number(2*o()/2+c/2)+"px, 0, -150px )":"translate(-"+Number(2*o()/2+c/2)+"px)",a=r?"translate3d( "+Number(2*o()/2+c/2)+"px, 0, -150px )":"translate("+Number(2*o()/2+c/2)+"px)"):(t=r?"translate3d( "+Number(2*o()/2+c/2)+"px, 0, -150px )":"translate("+Number(2*o()/2+c/2)+"px)",a=r?"translate3d( -"+Number(2*o()/2+c/2)+"px, 0, -150px )":"translate(-"+Number(2*o()/2+c/2)+"px)"),classie.removeClass(h.slideshow,"animatable"),("next"===e&&this.current<this.itemsCount-2||"prev"===e&&this.current>1)&&(n(l=this.slideshowItems["next"===e?this.current+2:this.current-2],a),classie.addClass(l,"show"));setTimeout(function(){classie.addClass(h.slideshow,"animatable"),classie.removeClass(h.currentItem,"current");var r="next"===e?h.nextItem:h.prevItem;classie.addClass(r,"current"),n(h.currentItem,"next"===e?m:d),h.nextItem&&n(h.nextItem,"next"===e?"":t),h.prevItem&&n(h.prevItem,"next"===e?t:""),l&&n(l,"next"===e?d:m);var o=function(t){if(i){if(-1===t.propertyName.indexOf("transform"))return!1;this.removeEventListener(s,o)}h.prevItem&&"next"===e?classie.removeClass(h.prevItem,"show"):h.nextItem&&"prev"===e&&classie.removeClass(h.nextItem,"show"),"next"===e?(h.prevItem=h.currentItem,h.currentItem=h.nextItem,l&&(h.nextItem=l)):(h.nextItem=h.currentItem,h.currentItem=h.prevItem,l&&(h.prevItem=l)),h.current="next"===e?h.current+1:h.current-1,h.isAnimating=!1};i?h.currentItem.addEventListener(s,o):o()},25)}},l.prototype._closeSlideshow=function(e){classie.removeClass(this.el,"slideshow-open"),classie.removeClass(this.slideshow,"animatable");var t=this,r=function(e){if(i){if("ul"!==e.target.tagName.toLowerCase())return;this.removeEventListener(s,r)}classie.removeClass(t.currentItem,"current"),classie.removeClass(t.currentItem,"show"),t.prevItem&&classie.removeClass(t.prevItem,"show"),t.nextItem&&classie.removeClass(t.nextItem,"show"),t.slideshowItems.forEach(function(e){n(e,"")}),t.isSlideshowVisible=!1};i?this.el.addEventListener(s,r):r()},l.prototype._setViewportItems=function(){this.currentItem=null,this.prevItem=null,this.nextItem=null,this.current>0&&(this.prevItem=this.slideshowItems[this.current-1]),this.current<this.itemsCount-1&&(this.nextItem=this.slideshowItems[this.current+1]),this.currentItem=this.slideshowItems[this.current]},l.prototype._resizeHandler=function(){var e=this;this._resizeTimeout&&clearTimeout(this._resizeTimeout),this._resizeTimeout=setTimeout(function(){e._resize(),e._resizeTimeout=null},50)},l.prototype._resize=function(){if(this.isSlideshowVisible){if(this.prevItem){var e=Number(-1*(o()/2+this.prevItem.offsetWidth/2));n(this.prevItem,r?"translate3d("+e+"px, 0, -150px)":"translate("+e+"px)")}if(this.nextItem){e=Number(o()/2+this.nextItem.offsetWidth/2);n(this.nextItem,r?"translate3d("+e+"px, 0, -150px)":"translate("+e+"px)")}}},e.CBPGridGallery=l}(window);